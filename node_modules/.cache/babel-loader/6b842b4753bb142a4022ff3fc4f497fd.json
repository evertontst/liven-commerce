{"ast":null,"code":"import _objectSpread from\"/Users/evertonluis/jobs/liven-commerce/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/evertonluis/jobs/liven-commerce/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/evertonluis/jobs/liven-commerce/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/evertonluis/jobs/liven-commerce/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/evertonluis/jobs/liven-commerce/node_modules/@babel/runtime/regenerator/index.js\";import{createContext,useContext,useState}from'react';import{toast}from'react-toastify';import{api}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";var CartContext=/*#__PURE__*/createContext({});export function CartProvider(_ref){var children=_ref.children;var _useState=useState(function(){var storagedCart=localStorage.getItem('@Liven:cart');if(storagedCart){return JSON.parse(storagedCart);}return[];}),_useState2=_slicedToArray(_useState,2),cart=_useState2[0],setCart=_useState2[1];var addProduct=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(productId){var updatedCart,productExists,currentAmount,amount,product,newProduct;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;//Get cart\nupdatedCart=_toConsumableArray(cart);//Check product productExists\nproductExists=updatedCart.find(function(product){return product.id===productId;});currentAmount=productExists?productExists.amount:0;amount=currentAmount+1;if(!productExists){_context.next=9;break;}productExists.amount=amount;_context.next=14;break;case 9:_context.next=11;return api.get(\"/products/\".concat(productId));case 11:product=_context.sent;newProduct=_objectSpread(_objectSpread({},product.data),{},{amount:1});updatedCart.push(newProduct);case 14:setCart(updatedCart);localStorage.setItem('@Liven:cart',JSON.stringify(updatedCart));_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](0);toast.error('Erro na adição do produto');case 21:case\"end\":return _context.stop();}}},_callee,null,[[0,18]]);}));return function addProduct(_x){return _ref2.apply(this,arguments);};}();var removeProduct=function removeProduct(productId){try{var updatedCart=_toConsumableArray(cart);var productIndex=updatedCart.findIndex(function(product){return product.id===productId;});if(productIndex>=0){updatedCart.splice(productIndex,1);setCart(updatedCart);localStorage.setItem('@Liven:cart',JSON.stringify(updatedCart));}else{throw Error();}localStorage.removeItem(JSON.stringify(productId));}catch(_unused){toast.error('Erro na remoção do produto');}};var updateProductAmount=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3){var productId,amount,updatedCart,productExists;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:productId=_ref3.productId,amount=_ref3.amount;_context2.prev=1;updatedCart=_toConsumableArray(cart);productExists=updatedCart.find(function(product){return product.id===productId;});if(!productExists){_context2.next=10;break;}productExists.amount=amount;setCart(updatedCart);localStorage.setItem('@Liven:cart',JSON.stringify(updatedCart));_context2.next=11;break;case 10:throw Error();case 11:_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](1);toast.error('Erro na alteração de quantidade do produto');case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[1,13]]);}));return function updateProductAmount(_x2){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsx(CartContext.Provider,{value:{cart:cart,addProduct:addProduct,removeProduct:removeProduct,updateProductAmount:updateProductAmount},children:children});}export function useCart(){var context=useContext(CartContext);return context;}","map":{"version":3,"names":["createContext","useContext","useState","toast","api","CartContext","CartProvider","children","storagedCart","localStorage","getItem","JSON","parse","cart","setCart","addProduct","productId","updatedCart","productExists","find","product","id","currentAmount","amount","get","newProduct","data","push","setItem","stringify","error","removeProduct","productIndex","findIndex","splice","Error","removeItem","updateProductAmount","useCart","context"],"sources":["/Users/evertonluis/jobs/liven-commerce/src/hooks/useCart.tsx"],"sourcesContent":["import { createContext, ReactNode, useContext, useState } from 'react';\nimport { toast } from 'react-toastify';\nimport { api } from '../services/api';\n\ninterface CartProviderProps {\n  children: ReactNode;\n}\n\ninterface UpdateProductAmount {\n  productId: number;\n  amount: number;\n}\ninterface Product {\n  id: number;\n  title: string;\n  price: number;\n  image: string;\n  amount: number;\n}\ninterface CartContextData {\n  cart: Product[];\n  addProduct: (productId: number) => Promise<void>;\n  removeProduct: (productId: number) => void;\n  updateProductAmount: ({ productId, amount }: UpdateProductAmount) => void;\n}\n\nconst CartContext = createContext<CartContextData>({} as CartContextData);\n\nexport function CartProvider({ children }: CartProviderProps): JSX.Element {\n  const [cart, setCart] = useState<Product[]>(() => {\n    const storagedCart = localStorage.getItem('@Liven:cart');\n    if (storagedCart) {\n      return JSON.parse(storagedCart);\n      }\n\n    return [];\n  });\n\n  const addProduct = async (productId: number) => {\n    try {\n      //Get cart\n      const updatedCart = [...cart];\n      \n      //Check product productExists\n      const productExists = updatedCart.find(product => product.id === productId);\n\n      const currentAmount = productExists ? productExists.amount :0;\n      const amount = currentAmount + 1;\n\n      if (productExists) {\n        productExists.amount = amount;\n      }\n      else {\n        const product = await api.get(`/products/${productId}`);\n\n        const newProduct = {\n          ...product.data,\n          amount: 1\n        }\n        updatedCart.push(newProduct);\n      }\n      setCart(updatedCart);\n      localStorage.setItem('@Liven:cart', JSON.stringify(updatedCart));\n    } catch (error) {\n      toast.error('Erro na adição do produto');\n    }\n  };\n\n  const removeProduct = (productId: number) => {\n    try {\n      const updatedCart = [...cart];\n      const productIndex = updatedCart.findIndex(product => product.id === productId);\n\n      if(productIndex >=0) {\n        updatedCart.splice(productIndex, 1);\n        setCart(updatedCart);\n        localStorage.setItem('@Liven:cart', JSON.stringify(updatedCart));\n      } else {\n        throw Error();\n      }\n      localStorage.removeItem(JSON.stringify(productId));\n    } catch {\n      toast.error('Erro na remoção do produto');\n    }\n  };\n\n  const updateProductAmount = async ({\n    productId,\n    amount,\n  }: UpdateProductAmount) => {\n    try {\n      const updatedCart = [...cart];\n      const productExists = updatedCart.find(product => product.id === productId);\n      if (productExists) {\n        productExists.amount = amount;\n        setCart(updatedCart);\n        localStorage.setItem('@Liven:cart', JSON.stringify(updatedCart));\n      } else {\n        throw Error();\n      }\n\n    } catch {\n      toast.error('Erro na alteração de quantidade do produto');\n    }\n  };\n\n  return (\n    <CartContext.Provider\n      value={{ cart, addProduct, removeProduct, updateProductAmount }}\n    >\n      {children}\n    </CartContext.Provider>\n  );\n}\n\nexport function useCart(): CartContextData {\n  const context = useContext(CartContext);\n\n  return context;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}